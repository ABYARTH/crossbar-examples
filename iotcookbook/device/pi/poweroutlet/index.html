<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <title>Raspberry Pi Power Outlet Switch</title>
</head>
<body>
   <h1>
      Raspberry Pi Power Outlet Switch
   </h1>


   <label for="adapter">Adapter</label>
   <input id="adapter" type="text" value="3">

   <button id="toggle">Toggle Outlet</button>

   <p>
      The simple switchable power outlets we are using do not provide a back channel. Because of this no power state (on/off) can be shown for the outlets!
   </p>

   <script src="http://autobahn.s3.amazonaws.com/autobahnjs/latest/autobahn.min.jgz"></script>
   <script>
      var session = null;

      // the WAMP connection to the Router
      //
      // var connection = new autobahn.Connection({
      //    url: 'ws://demo.crossbar.io:8080', // replace with URL of WAMP router if this doesn't serve the file
      //    realm: "realm1"
      // });

      var connection = new autobahn.Connection({
         url: 'ws://192.168.1.136:8080/ws', // replace with URL of WAMP router if this doesn't serve the file
         realm: "iot_cookbook"
      });


      // fired when connection is established and session attached
      //
      connection.onopen = function (sess, details) {

         session = sess;
         var state = "off";

         console.log("connected");

         var toggle = function() {
            console.log("toggle hit");

            var adapter = parseInt(document.getElementById("adapter").value, 10);

            if (state === "on") {
               session.call("io.crossbar.examples.iot.devices.pi.poweroutlet.switch", [adapter, "off"]).then(session.log, session.log);
               state = "off";
            } else {
               session.call("io.crossbar.examples.iot.devices.pi.poweroutlet.switch", [adapter, "on"]).then(session.log, session.log);
               state = "on";
            }
         }

         

         document.getElementById("toggle").addEventListener("click", toggle);

         console.log("post");

      };

      // fired when connection was lost (or could not be established)
      //
      connection.onclose = function (reason, details) {

         console.log("Connection lost: " + reason);

      }

      // now actually open the connection
      //
      connection.open();

   </script>
</body>
</html>