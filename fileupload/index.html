<!DOCTYPE html>
<html>

<head>
   <script src="bower_components/resumablejs/resumable.js"></script>
   <script src="bower_components/autobahn/autobahn.min.js"></script>
</head>

<body>
   <a href="#" id="browseButton">Select files</a>

   <script>
      // the URL of the WAMP Router (Crossbar.io)
      //
      var wsuri;
      if (document.location.origin === "null" || document.location.origin === "file://") {
         wsuri = "ws://127.0.0.1:8080/ws";

      } else {
         wsuri = (document.location.protocol === "http:" ? "ws:" : "wss:") + "//" +
                     document.location.host + "/ws";
      }

      var connection = new autobahn.Connection({
         url: wsuri,
         realm: 'realm1'
      });

      connection.onopen = function (session, details) {
         console.log("Connected", details);

         session.subscribe('re.upload', function(res) {
            session.log('upload event received', res);
         });

         var r = new Resumable({
            target: 'upload',
            chunkSize: 10 * 1024 * 1024,
            simultaneousUploads: 4,
            testChunks: true,
            query: {
               progress_uri: 'my.upload'
            }
         });

         r.assignBrowse(document.getElementById('browseButton'));

         r.on('fileSuccess', function(file) {
            console.debug(r.files);

            // enable repeated upload since other user can delete the file on the server
            // and this user might want to reupload the file
            file.cancel();
         });
      };

      connection.open();
   </script>
</body>

</html>
